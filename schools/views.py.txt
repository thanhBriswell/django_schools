from django.shortcuts import render
from django.template import loader # get template
from django.http import Http404, HttpResponseRedirect # redirect
from datetime import datetime # use in get date time
from django.core.urlresolvers import reverse

from .forms import StudentForm # form in django

from .models import Students # models

# Create your views here.
def index(request):
    # [0:5] # limit
    students_list = Students.objects.order_by('-class_name')
    template = loader.get_template('students/index.html')
    context = {
        'students_list': students_list
    }

    return render(request, 'students/index.html', context)

def student_detail(request, student_id):
    # raise Exception(student) # debug in django
    try:
        student = Students.objects.get(pk=student_id)
    except Students.DoesNotExist:
        raise Http404("Student does not exist")

    if request.method == 'POST':
        student.name = request.POST['name']
        student.class_name = request.POST['class_name']
        student.save()

    return render(request, 'students/detail.html', { 'student': student })

def student_add(request):
    if request.method == 'POST':
        # Create a form instance and populate it with data from the request (binding)
        form = StudentForm(request.POST)
        # check if the form is valid
        if form.is_valid():
            student = Students(
                name=request.POST['name'], 
                class_name=request.POST['class_name'], 
                address=request.POST['address'],
                birthday=datetime.strptime(request.POST['birthday'], '%Y-%m-%d')
            )
            student.save()
            # redirect to index
            return HttpResponseRedirect(reverse('index'))
    else:
        form = StudentForm()        

    return render(request, 'students/add.html', { 'form': form })